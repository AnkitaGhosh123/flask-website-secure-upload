<!DOCTYPE html>
<html>
<head>
    <title>Verify 2FA</title>
    <script>
        window.onload = function () {
            const lastSent = "{{ session.get('2fa_time') }}";
            const resendCount = "{{ session.get('resend_count', 0) }}";
            const button = document.getElementById('resendBtn');

            if (lastSent && resendCount < 5) {
                const last = new Date(lastSent);
                const now = new Date();
                const diff = Math.floor((now - last) / 1000); // seconds
                const wait = 120 - diff;

                if (wait > 0) {
                    button.disabled = true;
                    button.innerText = "Wait " + wait + "s to resend";

                    const interval = setInterval(() => {
                        if (wait - 1 <= 0) {
                            button.disabled = false;
                            button.innerText = "Resend 2FA Code";
                            clearInterval(interval);
                        } else {
                            wait -= 1;
                            button.innerText = "Wait " + wait + "s to resend";
                        }
                    }, 1000);
                }
            }
        }
    </script>
</head>
<body>
    <h2>Enter your 2FA code</h2>
    <form action="/2fa" method="POST">
        <input type="text" name="token" placeholder="Enter 6-digit code" required>
        <button type="submit">Verify</button>
    </form>

    {% if session.get('resend_count', 0) < 5 %}
    <form action="/resend_2fa" method="POST">
        <button id="resendBtn" type="submit">Resend 2FA Code</button>
    </form>
    {% else %}
    <p>Resend limit reached (5 times max).</p>
    {% endif %}
</body>
</html>
